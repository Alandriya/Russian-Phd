\chapter{Методы реконструкции случайных коэффициентов стохастического дифференциального уравнения Ито}
\label{ch:Methods}

\section{Обзор литературы}
\label{sec:ch1/Literature}

На границе между океаном и атмосферой турбулентные тепловые потоки сильно изменяются в различных пространственных и временных масштабах~\cite{small2019air, tian2017air}. Турбулентные потоки вносят значительный вклад в изменчивость общего стока в межгодовом масштабе времени ~\cite{bentamy2017review}.
Также была изучена взаимосвязь между динамикой океана и изменчивостью температуры в смешанном слое в разных регионах~\cite{ashin2019observed, schmeisser2019role}. Теплообмен между океаном и атмосферой тесно связан с температурой поверхности океана, который оказывает значительное влияние на региональный климат. Также известно, что большая часть изменчивости температуры поверхности определяется именно поверхностными тепловыми потоками ~\cite{patrizio2021quantifying}. 
Поведение циклонов и их взаимосвязь с ТПМ и тепловыми потоками, то есть взаимосвязь между приземным атмосферным давлением и тепловыми потоками были рассмотрены в работе ~\cite{tilinina2018association}.

Существует множество работ, посвященных применению методов разложения различных характеристик на ортогональные составляющие в метеорологии, океанологии и климатологии. Можно упомянуть как новаторские исследования ~\cite{lorenz1956empirical, bagrov1959analytic,Obukhov1960,Yudin1968}, так и современные~\cite{kobayashi2015jra}. Оригинальность нашей работы заключается в разработке и применении оригинального метода оценки соответствующих ковариационных матриц большой размерности и их разложения на естественные ортогональные функции с использованием модели СДУ Ито.

Взаимосвязь между аномалиями в явных и скрытых тепловых потоках и значениями SST над районами Северной Атлантики и Северной части Тихого океана была исследована в работе ~\cite{cayan1992latent}. Роль условий преобразования энергии изо дня в день в течение жизненного цикла Североатлантического колебания, которое оказывает существенное влияние на погоду и климат в различных временных масштабах рассматривалась в работе ~\cite{kim2024phase}. Была исследована реакция поверхностного слоя океана на неглубокую конвекцию в атмосфере~\cite{brilouet2024numerical}. Изменчивость в Североатлантическом европейском регионе рассматривалась с использованием модели только для атмосферы, основанной на смещениях SST~\cite{keeley2012impact}. Новизна нашего исследования заключается в изучении пар геофизических величин, таких как тепловые потоки воздуха и моря, атмосферное давление и температура поверхности моря. Мы стремимся выявить взаимосвязи между этими величинами и интерпретировать результаты, используя параметры стохастической модели.


Известно, что на поверхности раздела двух сред -- океана и атмосферы -- турбулентные потоки тепла имеют высокую волатильность на различных пространственно-временных масштабах (\cite{small2019air}, \cite{tilinina2018association}, \cite{tian2017air}). В работе \cite{bentamy2017review} для данных реанализа было продемонстрировано, что именно турбулентные потоки вносят основной вклад в изменчивость общего потока на межгодовом масштабе времени. Связь динамики океана и изменчивости температуры смешанного слоя в различных регионах изучается в целом ряде работ~\cite{ashin2019observed,schmeisser2019role,patrizio2021quantifying}.
% 	В работе \cite{patrizio2021quantifying} было показано, что динамический вклад океана в дисперсию температуры смешанного слоя имеет наибольшие значения в областях западных пограничных течений.
% 	, их продолжениями на восток и областями экваториального апвеллинга.
% 	Авторы также показывают, что динамика океана уменьшает дисперсию температур смешанного слоя в северном полушарии при рассмотрении во временных масштабах более нескольких лет, в результате чего утверждается, что в среднем по миру относительный вклад динамики океана в изменчивость температуры смешанного слоя уменьшается на все более низких частотах.
% 	Связь динамики океана и изменчивости температуры смешанного слоя в различных регионах изучается в целом ряде работе~\cite{ashin2019observed,schmeisser2019role,patrizio2021quantifying} лась в работе~\cite{schmeisser2019role}, где рассматриваются причины возникновения аномально выхоких поверхностных температур в период 2013-2015гг. в Северо-Восточной части Тихого океана, а также в статье \cite{}, где рассматривается их межсезонная и внутрисезонная изменчивость в области Андаманского моря. 
Потоки тепла между океаном и атмосферой тесно связаны с величиной SST (Sea Surface Temperature) -- температурой поверхности океана, оказывающей влияние на региональный климат. Известно, что большая часть изменчивости SST определяется именно рассматриваемыми поверхностными тепловыми потоками~\cite{schneider2015atmospheric,hausmann2017mechanisms,li2019decadal,blein2022parametrizing}. Существует целый ряд вопросов и проблем при количественной оценке тепловых потоков в процессе взаимодействия океана и атмосферы. Важно понять, где локально и как изменяются те области, в которых происходит максимальное взаимодействие, где количественно больше идет отток в атмосферу или наоборот поступление тепла и влаги из атмосферы, а где тепло больше перераспределяется внутри океана. Как это меняется по сезонам? Есть ли межгодовые тренды и колебания? Все эти вопросы окончательных ответов не имеют и более того, даже их постановка не кажется корректной в отсутствии адекватных моделей описания процессов взаимодействия.
% изучается десятилетняя изменчивость SST в юго-восточной части Индийского океана и ее влияние на
% региональный климат, причем показано, что большая часть изменчивости SST определяется именно рассматриваемыми поверхностными тепловыми потоками. Авторы статьи~\cite{hausmann2017mechanisms} показывают, что обратная связь турбулентного теплового потока между океаном и атмосферой является основным фактором, влияющим на настройку демпфирования временной шкалы аномалий температуры поверхности моря. Работа~\cite{schneider2015atmospheric} посвящена реакции атмосферы на слабые фронты температуры поверхности моря. В статье~\cite{blein2022parametrizing} изучается мезомасштабное усиление приземных турбулентных потоков на границе раздела воздух-море. В частности, декларируется, что оно обусловлено мезомасштабной изменчивостью скорости приземного ветра, особенно скоростью порывов ветра и мезомасштабными стандартными вариациями скорости ветра. В этом исследовании предлагается параметризация этих двух переменных.

Вероятностные результаты в данной области касаются аппроксимации распределения данных потоков тепла двухпараметрическим распределением Фишера--Триппета с оценкой его параметров по данным базы реанализа NCEP--NCAR за период 1948-2008 гг.~\cite{gulev2012probability}. В статье~\cite{FAO} изучено статистическое поведение экстремальных характеристик потоков (максимум, минимум) по области за весь период наблюдений в точках одноградусной сетки при различных осреднениях от суточных до годовых, а также средних значений по распределению и медиан. Кроме того, проведена аппроксимация вероятностных распределений для каждого из типов потоков тепла по отдельности и исследованы их совместные распределения.

Наиболее часто для анализа используются данные различных баз реанализа, содержащие аппроксимации реальных наблюдений~\cite{cronin2019air,leyba2019trends} на основе некоторых характерных значений для контактных сред. В данной статье в качестве данных для стохастической аппроксимации выступают элементы открытой базы реанализа ERA5\footnote{https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5}, формируемой Европейским центром среднесрочных прогнозов погоды.

Для изучения динамики процессов с учетом случайных факторов традиционным инструментом является аппарат случайных процессов. В физике плазмы~\cite{Espinos2018,Sexty2019} и финансовой математике~\cite{Bouchaud1998} хорошо известно стохастическое дифференциальное уравнение (СДУ) Ито (см. формулу~\eqref{Ito} далее). Однако в области климатологии модели на его основе используются лишь в небольшом количестве работ для описания процессов, протекающих в океане. В частности, см., например, статьи~\cite{van2021characterisation,toppaladoddi2021stochastic}, где в которых СДУ Ито используется для описания поведения потоков тепла между льдом и океаном в области Арктики.

% сформулирована гипотеза о том, что  В работе~\cite{FAO} на данных явных и скрытых потоков тепла в области Северной Атлантики из базы ERA-5 подробно исследуются статистические закономерности внутригодовой и межгодовой изменчивости с различными масштабами усреднения: дневным, месячным, годовым. Рассмотрено поведение экстремальных и средних потоков: в частности, показано существование положительного тренда максимума скрытого потока с течением времени.

% В данной работе не рассматриваются особенности измерения и алгоритмов приближения этих величин, данные реанализа этих величин были взяты из открытой базы ERA-5 и считаются известными безотносительно способа их получения. Фокус внимания данной работы состоит в оценивании и исследовании поведения случайных величин в математической модели стохастического дифференциального уравнения (СДУ) Ито~\ref{Ito}, в котором участвуют значения потоков тепла как значения случайного процесса.

% Данная статья продолжает и обобщает идею статьи \cite{Belyaev2021} по применению модели уравнения Ланжевена для описания потоков тепла между океаном и атмосферой. Приводится алгоритм оценки параметров данной модели и затем применяется для получения оценок с использованием данных из базы ERA-5 о потоках тепла в области Северной Атлантики. Кроме того, проводится исследование поведения полученных оценок с течением времени, рассматривается их взаимодействие и эффект преобладания диффузиозной компоненты над параметром сноса.

Первые исследования среднегодового хода явных потоков тепла по данным реанализа базы ERA5 за $2010$--$2020$~гг. с использованием СДУ Ито были проведены авторами данного исследования в статье~\cite{Belyaev2021}. В ней были изучены статистические закономерности внутригодовой и межгодовой изменчивости с различными масштабами усреднения: дневным, месячным, годовым. Также рассматривалось поведение экстремальных и средних потоков. В частности, показано существование положительного тренда максимума скрытого потока с течением времени. 

В данной статье анализируются как явные, так и скрытые потоки, в том числе и совместно, на значительно более длинном временном интервале $1979$--$2022$~гг. Предложены оригинальные методы оценивания векторного коэффициента сноса $a$ и матричного коэффициента $b$ СДУ Ланжевена, исследуется взаимовлияние этих величин, выявляются области преобладания диффузиозной компоненты над параметром сноса, а также рассматривается поведение таких их характеристик, как минимумы, максимумы и средние значения.
% Кроме того, проверяется выполнение условия корректности применения предлагаемой математической модели для подобного рода данных. 
Ориентированность на анализ этих величин связана с их физическим смыслом. Так, коэффициент сноса показывает преимущественное направление потоков внутри океана, а коэффициент диффузии позволяет выявить области основного обмена теплом океана с атмосферой. Кроме того, он важен при оценках теплобаланса.

Статья организована следующим образом:
% В разделе 2 приведен обзор известных подходов к описанию поведения явного и скрытого потоков тепла, применявшихся за последние 10 лет.
раздел~\ref{SecModel} содержит описание математической модели, применяющейся в данной работе, а также информацию об анализируемых данных. Раздел~\ref{SecMethods} посвящен вычислительным методам оценивания случайных коэффициентов СДУ Ланжевена. В разделе~\ref{SecSoftware} обсуждается архитектура программного комплекса, реализованного для проведения стохастического анализа потоков тепла с использованием высокопроизводительных вычислительных ресурсов. В разделе~\ref{SecAnalysis} проводится анализ поведения различных характеристик полученных оценок (максимум, минимум, среднее), а также исследуется взаимосвязь между оценками и значениями потоков, на основе которых они были построены. В разделе~\ref{SecDiscuss} обсуждаются полученые результаты и их связь с ранее установленными в данной области эффектами. В Приложении~\ref{AppExist} продемонстирована корректность применения стохастической модели для анализируемых данных. 


Одной из главных задач современной метеорологии, океанографии и климатологии является понимание того, как взаимодействуют тепловые потоки, температура поверхности моря и приземное атмосферное давление. Анализируя изменчивость и физические характеристики тепловых потоков и их взаимосвязь с другими метеорологическими переменными, такими как SST и давление на уровне моря, можно получить ценную информацию о климатической системе Земли. Эти знания имеют решающее значение для улучшения средне- и долгосрочного прогнозирования погоды. Это позволяет более точно прогнозировать опасные явления, такие как тропические ураганы, цунами и другие опасные явления. Кроме того, это помогает понять антропогенное воздействие на окружающую среду и различные другие факторы, влияющие на климат нашей планеты.



При построении количественных оценок тепловых потоков в системе океан-атмосфера большой интерес представляют вопросы о зонах со значительным взаимодействием и соответствующих местных характеристиках, а также о сезонных эффектах и межгодовых тенденциях и колебаниях.
\begin{itemize}
	\item Как меняются области, где происходит наиболее значимое взаимодействие, и каковы локальные характеристики этих областей?
	\item Где происходит количественный отток в атмосферу или, наоборот, поступление тепла и влаги из атмосферы, и где тепло в большей степени перераспределяется внутри океана?
	\item Как эти эффекты меняются в зависимости от времени года?
	\item Существуют ли межгодовые тенденции и колебания? Как изменения в тепловых потоках, температуре поверхности моря и атмосферном давлении проявляются количественно в различных масштабах пространства и времени?
	\item Существуют ли какие-либо изолированные океанские структуры, такие как квазициклонические или антициклонические вихри, где эти процессы взаимодействия можно в какой-то степени считать стационарными?
\end{itemize}
На эти вопросы нет однозначных ответов, и, более того, даже их формулировка может быть некорректной без адекватных математических моделей для описания процессов взаимодействия.
Такие вопросы рассматриваются и решаются в численных гидродинамических моделях, которые моделируют взаимодействие океана и атмосферы~\cite{gulev2012probability}.
Однако эти модели в значительной степени зависят от трудно поддающихся оценке внешних и внутренних факторов: коэффициентов вязкости, уровней турбулентности и скоростей обмена. Эти факторы либо неизвестны, либо их трудно определить на основе наблюдений. Кроме того, существует зависимость от начальных и граничных условий, которые также сложно определить. Некоторые компромиссы основаны на моделях, которые включают в себя ассимиляцию данных~\cite{FAO}. Однако, даже в случаях усвоения данных расчеты для долгосрочных периодов требуют установки дополнительных параметров.

Вероятностные и статистические модели, основанные исключительно на наблюдениях, могут быть более эффективными для долгосрочного моделирования и прогнозирования.
Распределения этих тепловых потоков могут быть аппроксимированы двухпараметрическим распределением Фишера-Типпета ~\cite{gulev2012probability}.
Ранее было изучено статистическое поведение экстремальных характеристик потока (максимум, минимум) в Североатлантическом регионе за весь период наблюдений в точках одноградусной сетки при различных средних масштабах от суточного до годового, а также распределения вероятностей для каждого типа тепловых потоков~\cite{FAO}.
Кроме того, были аппроксимированы распределения вероятностей для каждого типа тепловых потоков по отдельности и исследованы их совместные распределения.
Однако нет результатов для совместных распределений SST, потоков и давления, хотя все эти значения физически и статистически зависимы.

Мы расширяем математическую базу, представленную в наших предыдущих работах ~\cite{Belyaev2021,FAO, Gorshenin2023}, для изучения динамики процессов под воздействием случайных факторов, основываясь на стохастических дифференциальных уравнениях (СДУ)~\cite{Skorohod}. Хотя эти аспекты известны, они используются лишь в ограниченном числе исследований в области океанологии и метеорологии для описания процессов, происходящих в океане. Чаще всего для вероятностного анализа используются данные из различных баз данных реанализа, которые содержат приближения к реальным наблюдениям, основанные на определенных характеристиках контактирующих поверхностей.
Мы используем базу данных реанализа ERA5~\cite{hersbach2020era5}, созданную Европейским центром среднесрочных прогнозов погоды.

В работе ~\cite{van2021characterisation} были проведены исследования изменчивости явных и скрытых потоков, их экстремальных и средних значений в внутри- и межгодовом масштабе на основе данных из базы данных ERA5. Совместное поведение явных и скрытых потоков, их тренды и ковариационные функции в различных пространственно-временных масштабах изучались в работе ~\cite{toppaladoddi2021stochastic}.

Фундаментальная новизна нашего исследования по сравнению с предыдущими исследованиями в этой области (см., например, статьи~\cite{van2021 characterization,toppaladoddi2021stochastic}, а также раздел ~\ref{SecWorks}) заключается в том, что мы исследуем совместное распределение трех ключевых характеристик: температуры поверхности океана, суммарного теплового потока и приземного атмосферного давления.
Кроме того, мы используем метод Карунена-Лоэва, чтобы разложить эти величины на собственные векторы (ортогональные компоненты), обеспечивая более глубокое понимание лежащих в их основе закономерностей и взаимосвязей.

Представленные методы также используются для оценки векторного коэффициента дрейфа, а также матрицы диффузии в СДЕ Ито, при этом как коэффициент дрейфа, так и матрица диффузии зависят от времени и от всего вектора наблюдений (подробности см. в статьях ~\cite{Gorshenin2023,belyaev2024comparison}.





В системе океан–атмосфера поведение теплового потока и изменчивость каждого компонента играют важную роль, поскольку они оказывают значительное влияние \cite{perry1977ocean} на климатические особенности этой системы, что делает их количественный и качественный анализ одной из основных проблем современной океанологии и климатологии. Распределение явных и скрытых тепловых потоков было ранее исследовано и аппроксимировано с использованием двухпараметрического распределения Фишера-Типпетта.
В данной работе в качестве модели динамики изменчивости теплового потока в системе воздух-море используется хорошо известное стохастическое дифференциальное уравнение Ито (SDE) \cite{Pascucci2022}. Задача оценки (вообще говоря) случайных коэффициентов SDE, учитывая наблюдения за процессом, предполагает некоторые существенные допущения относительно математических свойств коэффициентов \cite{Yoshida1992, GenonCatalot1993, GenonCatalot1994, Wei2016}. В работах \cite{Yoshida1992, GenonCatalot1993, GenonCatalot1994, Wei2016} авторы предполагают, что коэффициенты являются функциями неизвестного параметра $\theta$; некоторые из них даже предполагают определенный тип зависимости от этого параметра. В работе \cite{FlorensZmirou1993} рассмотрен непараметрический случай, и оценка коэффициента диффузии, наряду с доказательством его сходимости и непротиворечивости, получена в предположении существования трех непрерывных ограниченных производных этого коэффициента, а также неслучайности и существования ограниченных производных коэффициента дрейфа. Также можно использовать основанный на ядре метод регрессии \cite{Lamouroux2009}.
Применение модели Ито для оценки эволюции приращения теплового потока было ранее рассмотрено в работе \cite{Belyaev2021}. Модель СДУ Ито обобщает хорошо известные статистические модели динамики климата, в частности, модели Будыко \cite{Budyko1974} и Хассельмана \cite{Hasselmann1976}. Эта модель также представлена в работах \cite{van2021characterisation, toppaladoddi2021stochastic}, где авторы использовали ее для описания поведения тепловых потоков между льдом и океаном в Арктическом регионе. Статистические особенности модели в двумерном случае были подробно рассмотрены в \cite{Pascucci2022}. Оценка неизвестного параметра модели в многомерном случае уравнения Ланжевена, являющегося вариантом уравнения Ито, была предложена в работе \cite{Voutilainen2022}.
Параметр дрейфа в уравнении Ито соответствует средним изменениям в поведении системы с течением времени, зависящим как от конкретного момента времени, так и от величины потока. Выявление областей, где этот коэффициент является значительным, может быть полезно для определения зон струйных течений, фронтов и синоптических вихрей, где происходят значительные динамические процессы. Области с малым коэффициентом дрейфа и большим стохастическим (диффузионным) коэффициентом соответствуют областям сильной турбулентности, включая энергетически активные области в Северной Атлантике. Поэтому задача оценки параметров стохастической модели поведения приращения тепловых потоков важна для решения задач с точки зрения математического моделирования.
Моделирование приращений потоков (в отличие от традиционно используемого для изучения значений самих потоков) адекватно описывает динамику потоков в среднесрочной и долгосрочной перспективе и, по-видимому, хорошо согласуется с реальными данными. Эта модель имеет ряд преимуществ перед известными численными или стохастическими моделями. Она довольно проста, поскольку форма модели определяется двумя коэффициентами, даже в многомерном случае (вектор дрейфа и матрица диффузии). Таким образом, можно количественно оценить поведение изучаемых характеристик, т.е. проанализировать и спрогнозировать их. Кроме того, эта схема является довольно общей, поскольку она включает как динамические модели со случайным воздействием (т.е. внешним воздействием), так и модели, основанные на тенденциях в периодических и случайных компонентах. Чтобы проверить адекватность модели, авторы ранее рассмотрели статистические закономерности внутри- и межгодовой изменчивости явных и скрытых тепловых потоков в Северной Атлантике, используя временные ряды из базы данных повторного анализа ERA5 \cite{Belyaev2022}. Было изучено поведение максимумов, минимумов, средних и медианных значений по рассматриваемой акватории с течением времени. Было показано, что в динамике скрытого теплового потока наблюдается положительная тенденция, и были оценены его параметры. Предлагаемая модель использует хорошо развитый аппарат теории стохастических дифференциальных уравнений и параболических уравнений Фоккера-Планка–Колмогорова, поэтому она удобна, например, для количественных и качественных оценок динамики потоков, их пространственно–временной изменчивости и вероятностей возникновения редких, но опасных событий., тропические ураганы.
Как было отмечено выше, непараметрический метод имеет строгие теоретические обоснования, однако он требует выполнения некоторого набора условий для коэффициентов, которые часто не могут быть проверены на реальных геофизических данных. Альтернативным рассматриваемым подходом является полупараметрический статистический метод, основанный на восстановлении распределений неизвестных коэффициентов случайного дрейфа и диффузии SDE, который подразумевает, что процесс оценки выполняется с использованием набора смесей нормалей произвольного масштаба сдвига. Стоит отметить, что в случае неслучайных коэффициентов рассматриваемого SDE, при принятии дополнительных предположений об измеримости в отношении естественной фильтрации и нормальности распределения начального значения процесса, решением оказывается некоторый гауссовский процесс с заданным средним значением и ковариационной функцией. Строгая теоретическая постановка задачи сходимости для полупараметрического метода сложна; этот вопрос обсуждается ниже в этой статье (см. раздел 3.3). Поэтому в данной статье полупараметрический подход, свободный от каких-либо дополнительных допущений, сравнивается с непараметрическим, чтобы продемонстрировать близость результатов и, как следствие, корректность его применения. Одно из важных потенциальных применений полупараметрического метода связано с задачей прогнозирования. В его рамках возникают теоретически обоснованные аппроксимации распределений для решений SDE. Эти распределения, или, скорее, параметры и компоненты связности, полученные в результате их оценки, могут быть использованы в рамках машинного обучения, основанного на физике (ML). Некоторые примеры эффективного улучшения прогнозов нейронной сети с использованием этого метода были продемонстрированы ранее в \cite{Kuzmin2022} для нескольких тепловых потоков в Лабрадорском море и Гольфстриме. Стоит отметить, что для получения точечных оценок с помощью первого подхода в данном случае может потребоваться решение нескольких задач SDE.

\section{Математическая модель}
\label{sec:Model}

Рассмотрим динамико-стохастическую модель вида
\begin{equation}
	\label{eq:Ito}
	dX = a(t,X)\,dt + b(t, X)\,dW(t), 
\end{equation}
называемую стохастическим дифференциальным уравнением Ито.

Модель~\eqref{eq:Ito} используется для описания случайных процессов диффузионного типа, в которых изменчивость самого процесса за малый промежуток времени мала по сравнению с изменчивостью его среднего значения и дисперсии~\cite{jin2020controls,van2021characterisation}. В таком случае за указанный малый промежуток времени эта изменчивость может рассматриваться как сумма квази-детерминированного процесса, определяемого сносом $a(t, X)$ (здесь термин <<квази>> учитывает наличие зависимости непосредственно от случайного процесса $X$), и чисто случайного процесса $b(t, X)$, не зависящего от первого слагаемого и определяемого диффузионной составляющей.

В формуле~\eqref{eq:Ito} $X = (X_1(t), X_2(t))$ -- двухмерный случайный процесс, значения которого в фиксированный момент времени $t$ имеют смысл вектора значений двух рассматриваемых физических величин в рассматриваемой географической точке, $a(t,X)$ и $b(t,X)$ –- случайные коэффициенты сноса и диффузии, зависящие от времени и значения потока, $dW(t)$ -- винеровский процесс, не зависящий от процесса $X$. Первая компонента векторного коэффициента переноса $a(t, X)=(a_1(t,X), a_2(t,X))$ соответствует первой, а вторая -- второй переменной. Для определения коэффициента $b$ рассмотрим оператор диффузии $B(t, x)$ с собственными значениями $\lambda_i(t, x), i=1,2$ и соответствующими собственными векторами $e_i(t, x), i=1,2$. Положим
\begin{equation}
	\label{b_vector}
	b_i(t,x) = \sqrt{\lambda_i(t, x)}e_i(t, x), \quad i=1,2,
\end{equation}
и объединим эти два вектора в матрицу. Коэффициентом $b(t, X)$ будем называть матрицу $2\times2$ со случайными значениями:
\begin{equation}
	\label{eq:b_coeff}
	b(t,X) =  \begin{bmatrix}  
		b_{11}(t, X) & b_{12}(t, X) \\
		b_{21}(t, X) & b_{22}(t, X)
	\end{bmatrix}
\end{equation}
Здесь $b_{ii}(t, X)$ -- соответственно диффузионные компоненты явного и скрытого потоков, а $b_{12}(t,X)$ и $b_{21}(t,X)$ описывают взаимодействие потоков, представляя собой в некотором смысле аналог ковариации. Однако, вообще говоря, $b_{12} \neq b_{21}$.

Решение СДУ \eqref{eq:Ito} представляет собой диффузионный процесс с матричным  коэффициентом диффузии $b^2(t, X)$ и векторным коэффициентом дрейфа $a(t,X)$. При этом случайные коэффициенты $a(t,X)$ и $b^2(t,X)$ представляют собой условное математическое ожидание и дисперсию приращений потока соответственно:
\begin{equation}
	\label{eq:a_coeff_E}
	a(t,X)= \frac{\E(X(t+dt)-X(t)|X(t)=x)}{dt},
\end{equation}
\begin{equation}
	\label{eq:b_coeff_D}
	b^2(t,X)= \frac{\D(X(t+dt)-X(t)|X(t)=x)}{dt},
\end{equation}
где E и D - математическое ожидание и дисперсия случайной величины соответственно.

Для существования решения уравнения~\eqref{eq:Ito} необходимо выполнение некоторых условий~\cite{Skorohod} на рассматриваемые борелевские функции $a(t, x)$ и $b_i(t, x), i=1,2$. В приложении~\ref{app:Existance} проведена проверка справедливости этих условий для изучаемых данных реанализа с целью обоснования корректности применения математической модели. Можно продемонстрировать, что для этих данных выполняются условия существования решения СДУ (см. книгу~\cite{Skorohod}, стр. 469). %Почему убрали про однозначное определение свойств временного ряда? Мне кажется, здесь было бы уместно

При отсутствии априорной информации о физической структуре процесса $X(t)$ проблема статистического восстановления функций $a(t)$ и $b(t)$ становится одной из важнейших. Из-за их случайной природы эта задача допускает, по крайней мере, два принципиально различных подхода к ее постановке. Первый из них заключается в получении оценок (которые сами по себе были бы случайными) функций $a(t)$ и $b(t)$, то есть в построении их точечных приближений. Второй подход представляет собой статистическую реконструкцию случайных коэффициентов $a(t)$ и $b(t)$ в терминах их распределений. То есть, зная некоторые свойства этих коэффициентов, можно найти оценки некоторых числовых параметров этих моделей. Оба подхода можно интерпретировать как физически реалистичные и осуществимые.

\section{Непараметрический метод оценивания}
\label{sec:Nonparametic}
Ключевым предположением при изучении рассматриваемых данных реанализа является предположение, что все их статистические характеристики зависят только от самих значений и не зависят от точки локализации. Иными словами, это допущение того, что значения потока, взятые в разных точках пространства, можно считать принадлежащими одной и той же генеральной совокупности с присущей ей некоторыми статистическими характеристиками. Это предположение вполне обосновано, так как традиционные расчетные формулы для потоков~\cite{cronin2019air,leyba2019trends} используют только сами значения контактных сред, но не их локацию. Поэтому при достаточно больших размерах рассматриваемой области для каждого интервала значений потоков тепла, от минимального до максимального значения потоков в фиксированную дату, найдется достаточно много пространственных точек, и соответственно значений потоков, чтобы оценка вероятности перехода значений потока из одного состояния в другое за небольшой отрезок времени была состоятельна.


\subsection{Дискретизация данных}
\label{sec:Disctretization}
Данные представляются в виде вариационного ряда в фиксированные моменты времени: все значения исследуемой величины потока разбиваются на некоторое количество равных интервалов от минимального до максимального значений и внутри каждой ячейки, независимо от пространственной локализации, проводится их осреднение по пространству. Как было отмечено во Введении, для получения данных реанализа используются только сами значения контактных сред, но не их местоположение. Поэтому при достаточно больших размерах рассматриваемой области для каждого интервала значений потоков тепла от минимального до максимального значения в фиксированную дату найдется достаточно много пространственных точек и, соответственно, значений потоков, чтобы оценка вероятности перехода значений потока из одного состояния в другое за небольшой отрезок времени была состоятельна. Подобный прием хорошо известен в анализе временных рядов, однако для анализа потоков тепла он впервые применен именно коллективом авторов статьи, и в этом смысле является оригинальным. Это позволяет представить временные ряды потоков тепла в виде реализации случайного процесса, описываемого СДУ Ито, и оценить его параметры.

\subsection{Формулы}
Для каждого фиксированного момента времени $t$ точечные оценки $a(t,x)$ и $b(t,x)$ могут быть построены только на основе значения потока.
% -- для этого достаточно определить вероятности перехода процесса из одного состояния в другое. То есть 
Для построения оценок в момент времени $t+1$ требуется на основе выборки по всей рассматриваемой географической области оценить вероятности перехода процесса $X(t)$ из множества значений в момент $t$ в множество значений в момент $t+1$. Будем обозначать значения процесса с помощью строчных букв.

В случае дискретных значений процесса рассмотрим условную вероятность
$\P(y|x) = \P(X(t+dt)=y|X(t)=x)$, а в абсолютно-непрерывном случае -- плотность
$p(y|x)dx = p(y<X(t)|x < X(t) = x)$.
Тогда коэффициенты $a(t, x)$ и $b(t, x)$ для некоторых фиксированных значений двух потоков %$X(t) = (X_1(t), X_2(t))$
$x = (x_1, x_2)$ %и $y = (y_1, y_2)$
определяются \cite{Skorohod} формулами
\begin{gather}
	\label{eq:a_formula_0}
	a_i(t,x_i) = \lim_{\varDelta t \to 0} \frac{1}{\varDelta t} \int\limits_{t}^{t+\varDelta t} (y_i-x_i)p(y_i|x_i)\,dy, \quad i = 1,2;\\
	\label{eq:b_formula_0}
	b_{i, j}^2(t, {x}) = \lim_{\varDelta t \to 0} \frac{1}{\varDelta t} \int\limits_{t}^{t+\varDelta t} (y_i-x_j)(y_i-x_j)^T p(y|x)\,dy, \quad i,j = 1,2.
\end{gather}

Таким образом, для оценки коэффициентов $a(t,x)$ и $b(t,x)$ необходимо оценить переходные вероятности, фигурирующие в правой части формул~\eqref{eq:a_formula_0}--\eqref{eq:b_formula_0} под знаком интеграла. На практике рассматривается процесс с дискретным временем, измерения которого проводятся через фиксированный промежуток времени $\varDelta t$, поэтому предел в правой части равенств~\eqref{eq:a_formula_0}--\eqref{eq:b_formula_0} исчезает, кроме того, с учетом конечности выборки измерений процесса, интегралы заменяются на конечные суммы.

Рассмотрим два соседних момента времени $t_1$ и $t_2$. Для того, чтобы оценить коэффициенты $a(t,x)$ и $b(t,x)$ по формулам~\eqref{eq:a_formula_0}--\eqref{eq:b_formula_0}, потребуется определить значения переходных вероятностей потока с использованием только множества значений в эти соседние моменты времени, поскольку не предполагается однородность процесса. Но в таком случае, учитывая вещественность значений, при фиксации значения $x$ в момент времени $t_1$ ему будет соответствовать, скорее всего, лишь одна географическая точка сетки, в которой достигается это значение. В таком случае соответствующее значение $y$ в момент времени $t_2$ будет единственным отвечающим состоянием с вероятностью перехода, равной $1$, что нельзя считать адекватной оценкой для описания переходов процесса. Поэтому необходимо разбить весь диапазон значений процесса в выборке на непересекающиеся интервалы и заменить все значения, попадающие в этот интервал, на общее значение. Наиболее естественным способом для этого является использование квантилей для построения интервалов с одинаковыми вероятностями попадания в них, с учетом описанного выше предположения локальной однородности данных.

Итак, для каждого типа потока отдельно за некоторый период времени рассматриваются все значения потока. Выбирая $1000$ чисел $\left\lbrace p_1, \ldots, p_{1000} \right\rbrace $, разделяющих  отрезок $[0, 1]$ на части одинаковой длины, для каждого $p_i$ найдем квантиль соответствующего порядка $q_i$, $i=1, \ldots, 1000$. Затем каждое значение потока, попавшее в интервал $[q_i, q_{i+1}]$, заменяется величиной $(q_i + q_{i+1})/2$. В некотором смысле это похоже на процесс приближения абсолютно-непрерывной случайной величины с помощью дискретной.

Обозначим полученное множество возможных значений процесса как $X_1, X_2, \dots, X_{1000}$, где $X_i = (q_i + q_{i+1})/2$. Далее для каждого $t \in [0, T-1]$ оценим вероятности перехода процесса из одного состояния в другое:
\begin{equation}
	\label{eq:p_formula}
	p_{ij} = \frac{\#\{X(t) = X_i, X(t+1) = X_j\}}{\#\{X(t) = X_i\},}
\end{equation}
где символ $\#$ обозначает количество элементов в соответствующем множестве, $j = 1,\ldots,1000$, $i \in \{1, \dots, 1000\}: \#\{X(t) = X_i\} > 0$. Очевидно, что при этом для $i$, соответствующих непустому набору в момент времени $t$, $\sum\limits_{j=1}^{1000} p_{ij} = 1$. Эту процедуру можно выполнить как рассматривая один тип потока в оба момента времени, так и разные типы потоков, получая $4$ набора вероятностей: для пары явный поток-явный поток, явный поток-скрытый поток, скрытый поток-явный поток и скрытый поток-скрытый поток. Обозначим эти наборы, соотвественно, $P_{sens-sens}, P_{sens-lat}, P_{lat-sens}, P_{lat-lat}$. 

Оценки для коэффициента переноса $a(t,x)$ в момент времени $t \in [0, T-1]$ в точках, соответствующих значению потока (явного или скрытого для разных компонент отвечающего вектора) $x_i \in \{X_1, \dots, X_{1000}\}$, строятся следующим образом:  
\begin{equation}
	\label{eq:a_formula}
	a_{x_i} = \sum\limits_{j=1}^{1000} (x_i - y)\cdot p_{ij}, \quad x_i, y \in \{X_1, \dots, X_{1000}\}, 
\end{equation}
где $p_{ij}$ берется по одному из наборов $P_{sens-sens}$ для явного или $P_{lat-lat}$ для скрытого потока. Таким образом, в момент времени $t$ в каждой географической точке определён вектор точечных оценок $a = (a_1, a_2)$, где $a_1$ соответствует явному типу потока, а $a_2$ -- скрытому.

Оценки квадрата коэффициента диффузии строятся аналогичным образом, но с некоторыми различиями. Во-первых, в каждой географической точке в момент времени $t$ предварительно оценивается матрица размера $2 \times 2$:
\begin{equation}
	\label{eq:b_coeff}
	b_t(x_{1,i}, x_{2, i}) =  \begin{bmatrix}  
		b_{11} & b_{12}\\
		b_{21} & b_{22}
	\end{bmatrix},
\end{equation}
где $x_{1, i}$ -- значение явного потока в рассматриваемой точке в момент времени $t$, а $x_{2, i}$ -- значение скрытого потока в этой же точке. Обозначим через $X_{sens}$ и ${X_{lat}}$ множества значений двух потоков в момент времени $t$, а через $Y_{sens}$ и ${Y_{lat}}$ множества значений двух потоков в момент времени $t+1$. Тогда:
\begin{gather}
	\label{eq:b_formula}
	b_{k,l, i} = \sum_{j=1}^{1000} (x_{k, i} - y_l)^2 \cdot p_{ij}, 
\end{gather}
где $k=1,2$ и $l=1,2$ - два индекса, соответствующие явному и скрытому типам потока в момент времени $t$ и $t+1$, соответственно, $x_1 \in X_{sens}, x_2 \in X_{lat}, y_1 \in Y_{sens}, y_2 \in Y_{lat}$. Нетрудно заметить, что при получении оценок для компонент матрицы суммируются квадраты разностей. Искомые оценки для коэффициента диффузии получаются извлечением матричного корня из полученной матрицы $b_t(x_{1,i}, x_{2, i})$.

При этом при реализации данного подхода периодически, хотя и довольно редко, появлялись ситуации, когда оцененная матрица в точке не обладала свойством положительной определенности. В таких случаях в найденной матрице-корне на побочной диагонали возникали комплексные значения. Было принято решение в таких случаях для этих чисел отбрасывать мнимую часть и сохранять только действительную, отрицательную часть. Поэтому, вопреки возможным ожиданиям, минимум шкалы значений оценок для коэффициента диффузии является отрицательным.

% 	Данная процедура формализована в виде алгоритма (блок-схемы) в приложении~\ref{AppAlgorithm}. Там же приводится оценка его вычислительной сложности и обсуждаются детали программной реализации разработанного пакета стохастического анализа потоков между океаном и атмосферой. 

\section{Полупараметрический метод оценивания}
\label{sec:Semiparametric}
Известно~\cite{Skorohod}, что для СДУ Ито~\ref{eq:Ito} с неслучайными коэффициентами при дополнительных предположениях об измеримости процесса в отношении естественной фильтрации и нормальности распределения начального значения решение имеет вид некоторого гауссовского процесса с заданным средним и ковариационной функцией. В этой ситуации приращения процесса также являются гауссовскими случайными величинами. Однако, если каждый параметр является случайным, естественным образом возникают распределения вида $\E \Phi (\frac{x-A}{B})$, то есть дисперсионно-сдвиговые смеси нормальных законов. Для данного метода более уместно говорить о восстановлении коэффициентов стохастического дифференциального уравнения, а не об их оценке. Предлагаемый полупараметрический подход позволяет реконструировать совместные одномерные распределения коэффициентов дрейфа и диффузии. Для этого выбирается часть исходного временного ряда (окно), и наблюдения в этом окне рассматриваются как однородная выборка. Теоретическое распределение этих наблюдений представляет собой нормальную смесь по шкале сдвига. Для математической корректности задачи непрерывные нормальные смеси аппроксимируются конечными нормальными смесями, которые можно идентифицировать~\cite{Teicher1961}. Следует отметить, что, в общем случае, задавая достаточно большое количество компонентов дискретной смеси, можно сделать аппроксимацию достаточно точной.

Формально, пусть $n \ge 1$, $t_0=0<t_1< ... <t_n$ - моменты времени, в которые известны значения процесса $X(t)$. Для простоты предположим, что $t_i - t_{i-1} = 1 \forall i\ge 1$. Как упоминалось выше, распределение приращений $X(t_i)-X(t_{i-1})$ процесса $X(t)$ может быть аппроксимировано непрерывными нормальными смесями:
$$
\label{eq:approx_diskr}
\P(X(t_i) - X(t_{i-1})<x) \approx \E \Phi\left(\frac{x-A_i}{B_i}\right),
$$
где $\Phi(x)$ - функция распределения стандартного нормального закона, а $A_i \in R$ и $B_i > 0$ - случайные величины. Аппроксимация конечными нормальными смесями выглядит следующим образом:
$$
\P(X(t_i) - X(t_{i-1})<x) \approx \sum\limits_{k=1}^K p_k \Phi\left(\frac{x-a_k}{b_k}\right),
$$
где $K \in N$, $p_k \ge 0, k=1,..., K$, $\sum\limits_{k=1}^K p_k = 1$. Параметры $p_k$, $a_k$ и $b_k$ в формуле~\eqref{approx_diskr} могут отличаться для моментов времени $t_i$ и $t_{i+1}$.

Для статистической оценки параметров $p_k$, $a_k$ и $b_k$ в формуле~\eqref{eq:approx_diskr} можно использовать метод скользящего разделения смесей. На основе выборки из окна выделяется конечная смесь, которая приблизительно соответствует теоретической смеси, то есть статистически определяются масштаб и параметры среднего компонент, а также их веса. Эти параметры определяют дискретную аппроксимацию совместного распределения коэффициентов.

Алгоритм максимизации математического ожидания (EM)~\cite{McLachlan2007} -- это хорошо известный итерационный метод получения оценок максимального правдоподобия, который может быть использован для параметров $p_k$, $a_k$ и $b_k$~\eqref{eq:approx_diskr}. Приведены явные формулы для параметров на итерационных этапах для рассматриваемого случая конечных нормальных смесей. 

Пусть $\phi(.)$ -- стандартная нормальная функция плотности вероятности. Переменные 
$$
g_{kj}^{(m)}= \frac{\frac{p_k^{(m)}}{\sigma_k^{(m)}} \phi\left(\frac{x_j - a_k^{(m)}}{\sigma_k^{(m)}} \right)}{\sum\limits_{r=1}^K \frac{p_r^{(m)}}{\sigma_r^{(m)}} \phi\left(\frac{x_j - a_r^{(m)}}{\sigma_r^{(m)}} \right)}
$$
являются апостериорными вероятностями того, что распределение случайной величины соответствует $i$-му компоненту смеси. Тогда параметры на $(m+1)$-й итерации определяются следующим образом ($i=1,...,K$; $n$ - размер выборки (окна)):
$$
p_k^{(m+1)} = \frac{1}{n} \sum\limits_{j=1}^n g_{kj}^{(m)},
$$
$$
a_k^{(m+1)} = \frac{1}{\sum\limits_{j=1}^n g_{kj}^{(m)}} \sum\limits_{j=1}^n g_{kj}^{(m)} x_j,
$$
$$
\sigma_k^{(m+1)} = \sqrt{\frac{1}{\sum\limits_{j=1}^n g_{kj}^{(m)}} \sum\limits_{j=1}^n g_{kj}^{(m)} (x_j - a_k^{(m+1)})^2}
$$
Хорошо известно, что лучшим в среднеквадратичным предиктором квадратичной интегрируемой случайной величины является ее математическое ожидание. Поэтому в качестве предикторов или реконструкций коэффициентов используются взвешенные выборочные значения предельных распределений параметров сдвига и масштаба. Затем окно перемещается на один шаг вправо, и весь процесс повторяется. Таким образом, ширина окна, т.е. количество наблюдений в выборке окна, не должна быть слишком маленькой, чтобы гарантировать приемлемую точность оценок параметров смеси, и не должна быть слишком большой, чтобы предотвратить излишнее сглаживание. Последнее требование делает весьма проблематичной даже попытку поставить задачу изучения традиционных свойств реконструкций (или оценок) коэффициентов стохастического дифференциального уравнения, таких как асимптотическая несмещенность или согласованность. Действительно, эти свойства предполагают, что размер выборки, т.е. ширина окна в рассматриваемом случае, бесконечно растет, тогда как при увеличении ширины окна возрастает возможность не заметить существенных изменений в поведении стохастического процесса.

Для каждого набора точек, которые попадают в одну и ту же группу во время дискретизации~\ref{sec:Disctretization} значений процесса $X(t)$, могут быть получены оценки среднего значения и дисперсии аппроксимирующей смеси, соответствующие желаемым оценкам коэффициентов $a(t,X)$ и $b(t,X)$. Для каждых двух матриц значений процесса $(X(t),X(t+1))$ на двух последовательных временных шагах получается соответствующая матрица $X_q(t)$ из процедуры дискретизации.


Как было упомянуто выше, элементы этой матрицы могут принимать только одно из $K$ различных значений из ранее построенного набора квантилей. Предполагается, что количество групп $K$ в данном методе намного меньше, чем в случае построения точечных оценок (см. раздел~\ref{sec:Nonparametic}), поскольку в этом случае для выбора групп с использованием дискретизации значения учитываются только в один момент времени $t$, в отличие от использования всех значений процесса матрица за весь период наблюдения $t \in \{0,...,T\}$. Каждому из квантилей $q \in \{q_1,..., q_K\}$ соответствует набор $\{(i_1, j_1), (i_2, j_2),..., (i_n, j_n)\}$ точек матрицы $X_q(t)$, соответствующих значению квантиля $q$. Это приводит к выборке $\{X[i_1,j_1 ], X[i_2,j_2 ],...,X[i_n,j_n]\}$ значений исходного процесса перед дискретизацией. После применения некоторой модификации алгоритма EM с предварительно заданным числом компонентов $N$ к построенной выборке, получаются соответствующие оценки максимального правдоподобия параметров каждого компонента (вектор среднего значения, дисперсии и веса $(a_i,\sigma_i^2, w_i), i=1,...,N)$.


Таким образом, в полупараметрическом методе оценки случайных коэффициентов СДУ Ито $a(t, X)$ и $b(t,X)$ в момент времени $t$ в точках с координатами $(i_1, j_1), (i_2,j_2),..., (i_n, j_n)$ задаются формулами:
$$
\hat{a}(t, i_m, j_m) = \sum\limits_{i=1}^N w_i a_i,
$$
$$
\hat{b^2}(t, i_m, j_m) = \sum\limits_{i=1}^N w_i (a_i^2 + \sigma_i^2),
$$
\subsection{Выделение компонент связности}
\label{sec:Components}
TODO \cite{2020_statistical_estimation_Langevin} \cite{gorshenin2020efficiency}



\section{Сравнение методов}
\label{sec:Compare}
Для проверки и сравнения точности описанных выше методов оценивания случайных коэффициентов СДУ Ито~\eqref{eq:Ito} генерируется реализация случайного процесса с заданными коэффициентами в виде линейной комбинации тригонометрических функций. Кроме того, проведено количественное сравнение предложенных методов по скрытым и явным тепловым потокам в Северной Атлантике с использованием данных повторного анализа из базы данных ERA5 за период $1979$--$2022$ гг. Показано, что результаты обоих методов довольно близки. В случаях некоторого расхождения в результатах предлагается геофизическая интерпретация.

\subsection{Модельные данные}
\label{sec:ModelData}
Результаты обоих рассмотренных статистических подходов можно сравнить на моделируемых случайных процессах, описываемых СДУ~\eqref{eq:Ito}, в терминах RMSE (среднеквадратичной ошибки):
$$
RMSE(\vec{x}, \vec{y}) = \sqrt{\sum\limits_{i=1}^n \frac{(x_i - y_i)^2}{n}}
$$

В качестве модельного распределения используется реализация процесса, соответствующего уравнению Ито~\eqref{Ito}, с использованием заданных неслучайных функций $a(t,X)$ и $b(t,X)$ тригонометрического вида. Выбор тестовых функций такого типа основан на том факте, что реальные геофизические данные часто имеют годовой цикл и другие периодические компоненты. Поэтому при применении статистических методов важно быть уверенным, что эти методы хорошо воспроизводят наличие гармоник в данных. Итак, тестовые функции определены следующим образом:
$$
a(t, X) = \sum\limits_{k=1}^M p_k cos(\omega t) \alpha X_{t-1},
$$
$$
b(t, X) = \sum\limits_{k=1}^M p_k cos(\omega t) \beta X_{t-1},
$$
где $w_k$ -- частоты $M$ рассматриваемых гармоник, а $p_k$ -- их веса, для которых выполняется ограничение $\sum\limits{k=1}^M p_k = 1$.

Для генерации некоторых данных, аналогичных формату географической карты, для проверки работоспособности алгоритмов берется несколько гармоник с соответствующими весами, чтобы их комбинация не сводилась к тривиальной и их количество не совпадало с количеством компонентов в смеси, из которых затем аппроксимируются данные. В частности, количество гармоник и их веса устанавливаются равными $M=4$, $p=\{0.4,0.3,0.2,0.1\}$; коэффициенты $\alpha$ и $\beta$ и набор частот подобраны таким образом, чтобы затухание процесса (схождение траекторий к нулю с течением времени) происходило не слишком быстро и, в то же время, различные компоненты не совпадали по фазе так часто, что позволяло им быть выделяемыми. В результате был выбран следующий набор параметров:
$$
\alpha = -0.3, \quad \beta = 0.01, \quad \omega = \left\{ \frac{\pi}{2}, \frac{2\pi}{3}, \frac{4\pi}{3}, 2\pi \right\}, \quad p=\{0.4, 0.3, 0.2, 0.1\}.
$$

Обозначая значение случайного процесса $X$ в момент времени $t$ в точке с координатами $(i,j)$ как $X_t[i,j]$, начальные значения (в момент времени $t=0$) в каждой точке карты являются реализацией случайной величины с нормальным распределением и параметрами $(1, 1)$:
$$
X_0[i,j] \sim N(1,1) \quad \forall i=1,...,n, \quad j=1,...,m.
$$
Затем значения в следующие моменты времени $t>0$ могут быть вычислены с использованием следующей рекуррентной формулы:
$$
X_t [i,j]= X_{t-1}[i,j] + a_{t-1} [i,j] + b_{t-1}[i,j]\Delta W_t,
$$

где $\Delta W_t \sim N(0,1)$ обозначает последовательность случайных значений-приращений винеровского процесса.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{Flux_composite_00000}\\
	а)
	\includegraphics[width=\textwidth]{Flux_composite_00001}\\
	б)
	\includegraphics[width=\textwidth]{Flux_composite_00002}\\
	в)
	\caption{Моделируемый процесс $X$ и соответствующие коэффициенты $a$ и $b$ в моменты времени (a) $t=0$, (б) $t=1$, (в) $t=2$}
	\label{fig:flux_simulation}
\end{figure}

На рисунке \ref{fig:flux_simulation} показаны сгенерированные триплеты значений процесса и соответствующие коэффициенты $a(t,X)$ и $b(t,X)$ на первых трех последовательных этапах моделирования матриц размером $100 \times 100$. Оба метода, описанные в разделе 2, применяются к построенному процессу, и полученные в результате оценки коэффициентов сравниваются с определенными функциями $a(t,X)$ и $b(t,X)$.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{A_difference_point_(0, 4)-A}\\
	а)
	\includegraphics[width=\textwidth]{B_difference_point_(0, 4)-B}\\
	б)
	\caption{Сравнение полученных оценок коэффициентов $a(t,X)$ (а) и $b(t,X)$ (б) непараметрическим (NP) и параметрическим (P) методами с реальными значениями в точке $(0,4)$}
	\label{fig:difference_0_4}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{A_difference_point_(0, 11)-A}\\
	а)
	\includegraphics[width=\textwidth]{B_difference_point_(0, 11)-B}\\
	б)
	\caption{Сравнение полученных оценок коэффициентов $a(t,X)$ (а) и $b(t,X)$ (б) непараметрическим (NP) и параметрическим (P) методами с реальными значениями в точке $(0,11)$}
	\label{fig:difference_0_11}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{A_difference_point_(0, 27)-A}\\
	\includegraphics[width=\textwidth]{B_difference_point_(0, 27)-B}\\
	\caption{Сравнение полученных оценок коэффициентов $a(t,X)$ (а) и $b(t,X)$ (б) непараметрическим (NP) и параметрическим (P) методами с реальными значениями в точке $(0,27)$}
	\label{fig:difference_0_27}
\end{figure}

На рисунках \ref{fig:difference_0_4}--\ref{fig:difference_0_27} показана эволюция целевых функций с шагом во времени и соответствующие оценки, полученные обоими методами в некоторых фиксированных точках матрицы (узлах сетки), демонстрирующие особенности обоих методов оценки. Ось времени показывает количество шагов генерации. Данные аналогичны показанным на рис. \ref{fig:flux_simulation}, но за гораздо более длительный период времени (около $100$ итераций).
На рисунке \ref{fig:difference_0_4} показан случай, в котором полупараметрический метод уступает непараметрическому с точки зрения RMSE, но гораздо лучше отражает поведение коэффициента диффузии. На рисунке \ref{difference_0_11} показана ситуация, в которой на первых этапах оба метода существенно отличаются от истинного значения коэффициента диффузии $b(t,X)$, но в последующие моменты времени полупараметрический метод начинает лучше описывать тенденцию, значительно превосходя кусочно-линейный вариант непараметрических оценок. Пример явного превосходства полупараметрического метода показан на рисунке \ref{fig:difference_0_27}.

\begin{table}[h!]
	\centering
	\caption{Ошибки в оценках коэффициента $a(t,X)$ полупараметрическим и непараметрическим методами}
	\begin{tabular}{|c|c|c|}
		\hline
		Координаты точки & Полупараметрический метод & Непараметрический метод \\
		\hline
		$(0, 4)$ & $0.02$ & $0.01$ \\
		$(0, 11)$ & $1.28$ & $0.01$ \\
		$(0, 27)$ & $0.72$ & $0.01$ \\
		\hline
	\end{tabular}
	\label{tab:errors_estimation_a}
\end{table}

\begin{table}[h!]
	\centering
	\caption{Ошибки в оценках коэффициента $b(t,X)$ полупараметрическим и непараметрическим методами}
	\begin{tabular}{|c|c|c|}
		\hline
		Координаты точки & Полупараметрический метод & Непараметрический метод \\
		\hline
		$(0, 4)$ & $0.14$ & $0.24$ \\
		$(0, 11)$ & $1.31$ & $0.75$ \\
		$(0, 27)$ & $1.75$ & $0.15$ \\
		\hline
	\end{tabular}
	\label{tab:errors_estimation_b}
\end{table}

В таблицах \ref{tab:errors_estimation_a} и \ref{tab:errors_estimation_b} представлены результаты оценки коэффициентов с помощью обоих методов.

Стоит отметить, что оценки коэффициента дрейфа $a(t,X)$, полученные обоими методами во всех рассмотренных точках смоделированной карты, намного ближе к реальным значениям целевых функций, чем соответствующие оценки коэффициента диффузии $b(t,X)$ к их объективным значениям.


\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{sensible_a_compare_semiparametric}\\
	а)
	\includegraphics[width=\textwidth]{sensible_a_compare_nonparametric}\\
	б)
	\caption{Оценки коэффициента дрейфа для явного потока в течение среднего года за период $1979-2022$ гг., полученные с помощью (а) полупараметрического метода и (б) непараметрического метода.} 
	\label{fig:sensible_compare_a}
\end{figure}


\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{sensible_b_compare_semiparametric}\\
	а)
	\includegraphics[width=\textwidth]{sensible_b_compare_nonparametric}\\
	б)
	\caption{Оценки коэффициента диффузии для явного потока в течение среднего года за период $1979-2022$ гг., полученные с помощью (а) полупараметрического метода и (б) непараметрического метода.} 
	\label{fig:sensible_compare_b}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{latent_a_compare_semiparametric}\\
	а)
	\includegraphics[width=\textwidth]{latent_a_compare_nonparametric}\\
	б)
	\caption{Оценки коэффициента дрейфа для скрытого потока в течение среднего года за период $1979-2022$ гг., полученные с помощью (а) полупараметрического метода и (б) непараметрического метода.} 
	\label{fig:latent_compare_a}
\end{figure}


\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{latent_b_compare_semiparametric}\\
	а)
	\includegraphics[width=\textwidth]{latent_b_compare_nonparametric}\\
	б)
	\caption{Оценки коэффициента диффузии для скрытого потока в течение среднего года за период $1979-2022$ гг., полученные с помощью (а) полупараметрического метода и (б) непараметрического метода.} 
	\label{fig:latent_compare_b}
\end{figure}

На рисунках \ref{fig:sensible_compare_a}-\ref{fig:latent_compare_b} показаны результаты обоих методов для явных и скрытых тепловых потоков в течение так называемого “среднего года”, которые построены следующим образом: в каждый из шести выбранных фиксированных дней в году в разное время года (а именно, $15$ февраля, $15$ апреля, $15$ июня, $15$ августа, $15$ октября, и $15$ декабря), полученные оценки усредняются по всем рассматриваемым годам. Это позволяет сгладить отдельные выбросы, возникающие как непосредственно в самих данных, так и из-за вычислительных ошибок при расчете точечных оценок. Результаты применения непараметрического метода к тем же данным и их анализ с геофизической точки зрения за этот период можно найти в работе~\cite{Gorshenin2023}.
Цветовая гамма на картах меняется с синего (при отрицательных значениях) на белый (при значениях, близких к нулю) и далее на красный (при положительных значениях). Яркость цвета в определенной точке соответствует расстоянию значения от нуля. Участки местности отмечены темно-зеленым цветом. Очевидно, что на картах, соответствующих оценкам коэффициента диффузии, синий цвет не отображается, поскольку значения неотрицательны (с физической точки зрения коэффициент диффузии эквивалентен дисперсии случайной величины).
На рисунке \ref{fig:sensible_compare_a} показан пример значений оценок, полученных с помощью обоих методов, для коэффициента дрейфа для явного потока в течение среднего года. Видно, что визуально они очень сильно совпадают, но оценки, полученные полупараметрическим методом, более плавно меняют цвет в соседних узлах карты (то есть имеют более близкие значения), а также имеют значения в областях пиков, которые в абсолютном выражении меньше, чем соответствующие полученные с помощью непараметрического метода. Тенденция изменения максимальных абсолютных значений, как и ожидалось, хорошо соответствует зонам сильных струйных течений в Северной Атлантике. Также наблюдается сезонный цикл: в зимние месяцы коэффициент дрейфа положительный, тогда как в летние месяцы он отрицательный.

Локализация, полученная с помощью непараметрического метода, является более грубой и точной, но менее детализированной, чем локализация, полученная с помощью полупараметрического метода. Аналогичные выводы справедливы и для коэффициента диффузии (см. рис. \ref{fig:sensible_compare_b}), хотя указанный эффект оказывается менее выраженным. Он характеризуется обширными зонами своего максимального значения и менее выраженным сезонным циклом, чем для соответствующего коэффициента дрейфа, хотя в летние месяцы максимум заметно меньше в обоих методах, как для явных, так и для скрытых потоков. На рисунках \ref{fig:latent_compare_a} и \ref{fig:latent_compare_b} представлены те же коэффициенты для скрытых потоков.

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{difference_a_compare_sensible}
	\caption{Абсолютная разность оценок коэффициента дрейфа для явного потока в течение среднего года за период $1979-2022$ гг.} 
	\label{fig:sensible_difference_a}
\end{figure}


\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{difference_b_compare_sensible}
	\caption{Абсолютная разность оценок коэффициента диффузии для явного потока в течение среднего года за период $1979-2022$ гг.} 
	\label{fig:sensible_difference_b}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{difference_a_compare_latent}
	\caption{Абсолютная разность оценок коэффициента дрейфа для скрытого потока в течение среднего года за период $1979-2022$ гг.} 
	\label{fig:latent_difference_a}
\end{figure}


\begin{figure}[!h]
	\centering
	\includegraphics[width=\textwidth]{difference_b_compare_latent}
	\caption{Абсолютная разность оценок коэффициента диффузии для скрытого потока в течение среднего года за период $1979-2022$ гг.} 
	\label{fig:latent_difference_b}
\end{figure}

Для наглядного сравнения результатов, полученных обоими методами сразу для всей Северной Атлантики, значения абсолютных различий оценок в каждой точке полуградусной сетки представлены на рисунках \ref{fig:sensible_difference_a}-\ref{fig:latent_difference_b}. Снова используется формат среднего значения за год.
Что касается коэффициентов дрейфа для потоков обоих типов, то вдоль Гольфстрима наблюдаются некоторые существенные различия в результатах применения методов (см. рисунки \ref{fig:sensible_difference_a} и \ref{fig:latent_difference_a}), в то время как для остальной части карты различия могут проявляться из-за ошибок в расчетах.

В то же время разница между полученными значениями коэффициента диффузии видна гораздо отчетливее (см. рисунки \ref{fig:sensible_difference_b} и \ref{fig:latent_difference_b}), особенно для зимы и весны среднего года в более северных широтах, а также в районе Гольфстрима. Этот факт может быть объяснен следующим образом. В северных широтах существует больше случайных факторов, определяющих взаимодействие океана и атмосферы, из–за большего разброса температур и более сильных ветров, которые в значительной степени определяют возникающие потоки. Это один из наиболее важных аргументов в пользу более точной полупараметрической процедуры оценки (см. раздел \ref{sec:Semiparametric}).

В статье представлены исследования по применению полупараметрического метода для восстановления коэффициентов случайного дрейфа $a(t,X)$ и диффузии $b(t,X)$ в СДУ Ито и сравнения этого метода с непараметрическим методом, используя как синтетически сгенерированные данные, так и данные повторного анализа явного и скрытого тепла потоки в Северной Атлантике за период с $1979$ по $2022$ год из базы данных ERA5.
К преимуществам непараметрических процедур относится возможность теоретического доказательства свойств оценок, например, их согласованности, в том числе для многомерного случая. Однако этот метод требует нескольких дополнительных допущений. Процедура полупараметрической реконструкции свободна от них. Необходимо только наличие решения стохастического дифференциального уравнения. Однако этот метод ориентирован на выборки ограниченного объема (окна), что накладывает ограничения на возможность доказательства асимптотических статистических свойств. Однако эмпирическое сравнение обоих методов, приведенное в статье, показывает сходство их результатов, что указывает на возможность использования этих методов для прикладного математического моделирования.

\section{Разложение коэффициента диффузии на собственные вектора}
\label{sec:Karhunen}

Модель~\eqref{eq:Ito} в дискретном виде может быть представлена в виде
\begin{equation}
	\label{eq:discrete_Ito}
	X(t+\Delta t) = a(t,X) \Delta t + b(t,X) (W (t+\Delta t)-W(t))	
\end{equation}
Здесь $X(t)$ и $a(t,X)$ - случайные векторы длиной $N$, $b(t,X)$ - матрица размера $N\times N$, а $W(t)$ -- Винеровский процесс, вектор длины $N$ с независимыми компонентами, который не зависит от процесса $X(t)$. Матрица $b(t,X)$ квадратная, невырожденная, положительно определенная и, следовательно, имеет полный набор собственных векторов $e_1,...,e_N$ и собственных значений $\lambda_1,...,\lambda_N$. Используя стандартный алгебраический метод декомпозиции по базису, из ~\eqref{eq:discrete_Ito} можно получить
\begin{equation}
	\label{eq:decomposition}
	X(t+\Delta t) = X(t) + a(t,X) \Delta t + \sum_{i=1}^N \lambda_i e_i \eta_i
\end{equation}
где $\eta_i= (e_i,W(t+\Delta t)-W(t))$ -- случайная величина и скалярное произведение векторов $e_i$ и $W(t+\Delta t)-W(t)$. Это гауссова случайная величина с нулевым средним значением и дисперсией, равной $\Delta t$, поскольку сумма составляющих вектора $e_i$ определяется однозначно из-за их ортонормированности. Вектор $W (t + \Delta t)-W (t)$ является гауссовым с независимыми компонентами и ковариационной матрицей с ненулевыми диагональными элементами, равными $\Delta t$. Чтобы проанализировать поведение приращений процесса $X(t+\Delta t) - X(t)$, необходимо изучить поведение коэффициента $a(t,X)$ и поведение собственных векторов $e_1,...,e_N$ и собственных значений $\lambda_1,...,\lambda_N$. Этому посвящен следующий раздел.

TODO
Мы разбиваем шкалу значений временных рядов за достаточно длительный период времени ($10$ лет) на сегменты, вероятности попадания в которые случайно выбранных значений были бы максимально близки друг к другу. Мы называем этот процесс квантификацией.

Алгоритм декомпозиции заключается в следующем:
\begin{itemize}
	\item Рассмотрим два временных ряда $X,Y$ (не обязательно разных, может быть $X \equiv Y$). Их значения зависят от координаты точки сетки (с использованием одномерной проекции) и от рассматриваемого момента времени: $X=X(p,t), Y=Y(p,t)$. 
	\item Давайте разделим весь диапазон значений каждого из рядов на $n_{bins}=100$ непересекающихся и равновероятных (построенных с использованием квантилей) интервалов. Для каждой последующей пары дней $(t,t+dt)$, где $dt$ равняется одному дню, выполняются следующие шаги:
	\begin{itemize}
		\item Инициализируем ковариационную матрицу $B$ размера $n_{bins} \times n_{bins}$.
		
		\item Для каждого интервала с номером $i_1$ $(0 \leqslant i_1 \leqslant n_{bins}-1)$ по первой переменной $X$ и независимо для каждого интервала с номером $j_1$ $(0 \leqslant j_1 \leqslant n_{bins}-1)$ по второй переменной $Y$ выбираются точки первого временного ряда в момент времени $t$, которые попадают в интервал $i_1$, обозначим их через $points_{x1}$ и для второго временного ряда в момент времени $t$, попадающего в интервал с номером $j_1$ ($points_{y1}$).
		
		
		\item Для этих точек вычисляются два вектора:
		\begin{equation*}
			vec_1 = X_{points_{x1},t+dt} - mean(X_{points_{x1},t}),\quad
			vec_2 = Y_{points_{y1},t+dt} - mean(Y_{points_{y1},t}).
		\end{equation*}
		В то же время значения $mean(X[points_{x1},t]$) рассчитаны ранее на основе оценок коэффициента дрейфа $a$.
		
		\item Давайте вычислим сумму произведений всех возможных пар этих двух векторов и присвоим соответствующему элементу матрицы $B$:
		\begin{equation*}
			B_{i_1, j_1} = \sum v_1 \cdot v_2, \quad v_1 \in vec_1, v2 \in vec_2.
		\end{equation*}
		Здесь неявно используется закон полной вероятности. Он требует, чтобы мы учитывали вероятности переходов. Однако, поскольку мы используем равновероятные деления интервалов, вероятности для каждого интервала примерно одинаковы, и различиями между ними можно пренебречь. При этом учитывается размерность задачи, то есть берется матрица между значениями разных (либо одних и тех же) переменных.
		
		\item В случае различных переменных в паре $(X,Y)$ вместо матрицы $B$ рассмотрим матрицу $B^*$, полученную из следующего соотношения: ${B^*}^2= B \cdot B^T$.
		
		
		\item Давайте разложим матрицу $B$ на собственные значения и векторы, отсортировав их в порядке убывания абсолютных значений собственных значений: $\lambda_1,\dots,\lambda_{n_{bins}}$; $v_1,\dots,v_{n_{bins}}$.
		
		\item Рассмотрим пару $(\lambda_i, v_i)$, где $\lambda_i$ - это число (вообще говоря, комплексное), а $v_i$ - одномерный вектор длиной $n_{bins}$ (вообще говоря, комплексный). Собственное значение $\lambda_i$ соответствует второй переменной (временной ряд $Y$), что приводит к следующему правилу построения: 
		
		\item Создадим пустую карту $M$, которая представляет собой матрицу размером $161 \times 181$. Для каждого интервала с номером $j_1$ $(0 \leqslant j_1 \leqslant n_{bins}-1)$ в соответствии со второй переменной $Y$ выполняется поиск точек второй строки в момент времени $t+dt$, попадающих в интервал с номером $j_2$: $points_{y2}$. Давайте присвоим действительную часть соответствующего элемента собственного вектора с номером $j_2$ всем точкам этого множества: $M[points_{y2}] = v_i[j_2]$.
	\end{itemize}
\end{itemize}




